<div class="monitor-container" *ngIf="!loading && patient && currentUser">

  <div class="patient-header">
    <h1 class="patient-name">{{ patient?.name }}</h1>
    <div class="patient-therapist">
      <span class="therapist-info">Terapeuta: {{ getUserInfo() }}</span>
    </div>
    <div class="edit-icon" (click)="goBackToPatients()">⬅️</div>
  </div>

  <div class="monitor-layout">

    <div class="patient-info">
      <div class="info-row">
        <span class="label">Edad:</span>
        <span class="value">{{ patient?.age }}</span>
      </div>

      <div class="info-row">
        <span class="label">Género:</span>
        <span class="value">{{ patient?.gender }}</span>
      </div>

      <div class="info-row">
        <span class="label">Sesión:</span>
        <span class="value">{{ patient?.session }}</span>
      </div>

      <div class="info-row">
        <span class="label">Cuarto:</span>
        <span class="value">{{ patient?.room }}</span>
      </div>

      <div class="info-row">
        <span class="label">Ritmo:</span>
        <span class="value rhythm-value" [style.color]="getRhythmColor()">
          {{ patient?.rhythm }}
        </span>
      </div>

      <div class="info-row">
        <span class="label">Creado:</span>
        <span class="value">{{ patient?.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
      </div>

      <div class="info-row">
        <span class="label">Última actualización:</span>
        <span class="value">{{ patient?.lastUpdated | date:'dd/MM/yyyy HH:mm:ss' }}</span>
      </div>

      <div class="info-row">
        <span class="label">Hora actual:</span>
        <span class="value">{{ getCurrentTime() }}</span>
      </div>
    </div>


    <div class="vitals-monitor">

      <div class="heart-rate-indicator">
        <div class="heart-icon">❤️</div>
        <span class="heart-label">Ritmo Cardíaco</span>
      </div>


      <div class="heart-rate-display">
        <div class="bpm-container">
          <span class="bpm-value">{{ patient?.heartRate?.current }}</span>
          <span class="bpm-label">bpm</span>
        </div>
        <div class="status-label" [style.color]="getHeartRateColor()">
          {{ patient?.heartRate?.status }}
        </div>
      </div>


      <div class="heart-wave-section">
        <div class="wave-header">
          <span class="wave-label">Monitoreo en Tiempo Real</span>
          <div class="info-icon">📊</div>
        </div>

        <div class="wave-display">
          <div class="wave-info">
            <span class="wave-title">BPM Actual</span>
            <span class="wave-value">{{ patient?.heartRate?.current }}</span>
          </div>

          <div class="wave-chart">
            <svg width="100%" height="80" viewBox="0 0 300 80">
              <polyline
                [attr.points]="generateWavePoints()"
                fill="none"
                [attr.stroke]="getHeartRateColor()"
                stroke-width="2">
              </polyline>
              <!-- Línea base -->
              <line x1="0" y1="40" x2="300" y2="40" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="5,5"/>
            </svg>
          </div>


          <div class="time-axis">
            <span *ngFor="let time of getTimeLabels()" class="time-label">{{ time }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="loading-container" *ngIf="loading">
  <div class="loading-spinner"></div>
  <p>Cargando datos del paciente...</p>
</div>


<div class="error-container" *ngIf="error">
  <p class="error-message">{{ error }}</p>
  <button (click)="loadPatient()" class="retry-button">Reintentar</button>
  <button (click)="goBackToPatients()" class="retry-button" style="margin-left: 10px; background: #6c757d;">
    Volver a Pacientes
  </button>
</div>


<div class="error-container" *ngIf="!currentUser && !loading">
  <p class="error-message">Usuario no autenticado</p>
  <button (click)="goBackToPatients()" class="retry-button">Ir a Pacientes</button>
</div>
